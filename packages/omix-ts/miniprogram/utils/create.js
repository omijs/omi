"use strict";
/*!
 *  omix v2.1.0 by dntzhang
 *  Github: https://github.com/Tencent/omi
 *  MIT Licensed.
*/
Object.defineProperty(exports, "__esModule", { value: true });
var obaa_1 = require("./obaa");
var path_1 = require("./path");
var changes = [];
function create(store, option) {
    if (arguments.length === 2) {
        if (!store.instances) {
            store.instances = {};
        }
        if (!store.onChange) {
            store.onChange = function (fn) {
                changes.push(fn);
            };
        }
        if (!store.offChange) {
            store.offChange = function (fn) {
                for (var i = 0, len = changes.length; i < len; i++) {
                    if (changes[i] === fn) {
                        changes.splice(i, 1);
                        break;
                    }
                }
            };
        }
        var hasData_1 = typeof option.data !== 'undefined';
        if (option.data) {
            option.data.$ = store.data;
        }
        else {
            option.data = store.data;
        }
        observeStore(store);
        var onLoad_1 = option.onLoad;
        option.onLoad = function (e) {
            this.store = store;
            option.use && (this.__updatePath = path_1.getPath(option.use));
            this.__use = option.use;
            this.__hasData = hasData_1;
            store.instances[this.route] = [];
            store.instances[this.route].push(this);
            this.computed = option.computed;
            this.setData(option.data);
            var using = path_1.getUsing(store.data, option.use);
            option.computed && compute(option.computed, store, using);
            this.setData(using);
            onLoad_1 && onLoad_1.call(this, e);
        };
        Page(option);
    }
    else {
        var ready_1 = (store.lifetimes && store.lifetimes.ready) || store.ready;
        store.lifetimes = store.lifetimes || {};
        store.ready = store.lifetimes.ready = function () {
            var page = getCurrentPages()[getCurrentPages().length - 1];
            store.use && (this.__updatePath = path_1.getPath(store.use));
            this.store = page.store;
            this.__use = store.use;
            this.computed = store.computed;
            store.data = this.store.data;
            this.setData(store.data);
            var using = path_1.getUsing(this.store.data, store.use);
            store.computed && compute(store.computed, this.store, using);
            this.setData(using);
            this.store.instances[page.route].push(this);
            ready_1 && ready_1.call(this);
        };
        Component(store);
    }
}
function compute(computed, store, using) {
    for (var key in computed) {
        using[key] = computed[key].call(store.data);
    }
}
function observeStore(store) {
    obaa_1.default(store.data, function (prop, value, old, path) {
        var patch = {};
        if (prop.indexOf('Array-push') === 0) {
            var dl = value.length - old.length;
            for (var i = 0; i < dl; i++) {
                patch[path_1.fixPath(path + '-' + (old.length + i))] = value[(old.length + i)];
            }
        }
        else if (prop.indexOf('Array-') === 0) {
            patch[path_1.fixPath(path)] = value;
        }
        else {
            patch[path_1.fixPath(path + '-' + prop)] = value;
        }
        _update(patch, store);
    });
}
function _update(kv, store) {
    for (var key in store.instances) {
        store.instances[key].forEach(function (ins) {
            if (store.updateAll || ins.__updatePath && path_1.needUpdate(kv, ins.__updatePath)) {
                if (ins.__hasData) {
                    for (var pk in kv) {
                        kv['$.' + pk] = kv[pk];
                        delete kv[pk];
                    }
                    ins.setData.call(ins, kv);
                }
                else {
                    ins.setData.call(ins, kv);
                }
                var using = path_1.getUsing(store.data, ins.__use);
                compute(ins.computed, store, using);
                ins.setData(using);
            }
        });
    }
    changes.forEach(function (change) {
        change(kv);
    });
    store.debug && storeChangeLogger(store, kv);
}
function storeChangeLogger(store, diffResult) {
    try {
        var preState = wx.getStorageSync("CurrentState") || {};
        var title = "State Changed";
        console.groupCollapsed("%c  " + title + " %c " + Object.keys(diffResult), 'color:#e0c184; font-weight: bold', 'color:#f0a139; font-weight: bold');
        console.log("%c    Pre State", 'color:#ff65af; font-weight: bold', preState);
        console.log("%c Change State", 'color:#3d91cf; font-weight: bold', diffResult);
        console.log("%c   Next State", 'color:#2c9f67; font-weight: bold', store.data);
        console.groupEnd();
        wx.setStorageSync("CurrentState", store.data);
    }
    catch (e) {
        console.log(e);
    }
}
create.obaa = obaa_1.default;
exports.default = create;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY3JlYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQTs7OztFQUlFOztBQUVGLCtCQUF5QjtBQUN6QiwrQkFBK0Q7QUFPL0QsSUFBTSxPQUFPLEdBQThCLEVBQUUsQ0FBQTtBQXlKN0MsU0FBUyxNQUFNLENBQUMsS0FBNEIsRUFBRSxNQUFtQjtJQUMvRCxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO1FBQzFCLElBQUksQ0FBQyxLQUFLLENBQUMsU0FBUyxFQUFFO1lBQ3BCLEtBQUssQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFBO1NBQ3JCO1FBRUQsSUFBRyxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUM7WUFDakIsS0FBSyxDQUFDLFFBQVEsR0FBRyxVQUFTLEVBQXVCO2dCQUMvQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFBO1lBQ2xCLENBQUMsQ0FBQTtTQUNGO1FBRUQsSUFBRyxDQUFDLEtBQUssQ0FBQyxTQUFTLEVBQUM7WUFDbEIsS0FBSyxDQUFDLFNBQVMsR0FBRyxVQUFTLEVBQXVCO2dCQUNoRCxLQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBQyxHQUFHLEdBQUUsT0FBTyxDQUFDLE1BQU0sRUFBQyxDQUFDLEdBQUMsR0FBRyxFQUFDLENBQUMsRUFBRSxFQUFDO29CQUMxQyxJQUFHLE9BQU8sQ0FBQyxDQUFDLENBQUMsS0FBSyxFQUFFLEVBQUM7d0JBQ25CLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFBO3dCQUNwQixNQUFLO3FCQUNOO2lCQUNGO1lBQ0gsQ0FBQyxDQUFBO1NBQ0Y7UUFFRCxJQUFNLFNBQU8sR0FBRyxPQUFPLE1BQU0sQ0FBQyxJQUFJLEtBQUssV0FBVyxDQUFBO1FBQ2xELElBQUksTUFBTSxDQUFDLElBQUksRUFBRTtZQUNmLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLEtB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QUMsSUFBSSxHQUFHLGNBQUksQ0FBQTtBQUdsQixrQkFBZSxNQUFNLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiFcbiAqICBvbWl4IHYyLjEuMCBieSBkbnR6aGFuZ1xuICogIEdpdGh1YjogaHR0cHM6Ly9naXRodWIuY29tL1RlbmNlbnQvb21pXG4gKiAgTUlUIExpY2Vuc2VkLlxuKi9cblxuaW1wb3J0IG9iYWEgZnJvbSAnLi9vYmFhJ1xuaW1wb3J0IHsgZ2V0UGF0aCwgbmVlZFVwZGF0ZSwgZml4UGF0aCwgZ2V0VXNpbmcgfSBmcm9tICcuL3BhdGgnXG5cblxuaW50ZXJmYWNlIFN0b3JlQ2hhbmdlQ2FsbGJhY2sge1xuICAoZGV0YWlsOiBhbnkpOiB2b2lkO1xufVxuXG5jb25zdCBjaGFuZ2VzOkFycmF5PFN0b3JlQ2hhbmdlQ2FsbGJhY2s+ID0gW11cblxuaW50ZXJmYWNlIElQYWdlU2Nyb2xsT3B0aW9uIHtcbiAgLyoqIOmhtemdouWcqOWeguebtOaWueWQkeW3sua7muWKqOeahOi3neemu++8iOWNleS9jXB477yJICovXG4gIHNjcm9sbFRvcDogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgSVRhYkl0ZW1UYXBPcHRpb24ge1xuICAvKiog6KKr54K55Ye7dGFiSXRlbeeahOW6j+WPt++8jOS7jjDlvIDlp4vvvIzmnIDkvY7ln7rnoYDlupPvvJogYDEuOS4wYCAqL1xuICBpbmRleDogc3RyaW5nO1xuICAvKiog6KKr54K55Ye7dGFiSXRlbeeahOmhtemdoui3r+W+hO+8jOacgOS9juWfuuehgOW6k++8miBgMS45LjBgICovXG4gIHBhZ2VQYXRoOiBzdHJpbmc7XG4gIC8qKiDooqvngrnlh7t0YWJJdGVt55qE5oyJ6ZKu5paH5a2X77yM5pyA5L2O5Z+656GA5bqT77yaIGAxLjkuMGAgKi9cbiAgdGV4dDogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSVNoYXJlQXBwTWVzc2FnZU9wdGlvbiB7XG4gIC8qKiDovazlj5Hkuovku7bmnaXmupDjgIJcbiAgICpcbiAgICog5Y+v6YCJ5YC877yaXG4gICAqIC0gYGJ1dHRvbmDvvJrpobXpnaLlhoXovazlj5HmjInpkq7vvJtcbiAgICogLSBgbWVudWDvvJrlj7PkuIrop5Lovazlj5Hoj5zljZXjgIJcbiAgICpcbiAgICog5pyA5L2O5Z+656GA5bqT77yaIGAxLjIuNGBcbiAgICovXG4gIGZyb206ICdidXR0b24nIHwgJ21lbnUnIHwgc3RyaW5nO1xuICAvKiog5aaC5p6cIGBmcm9tYCDlgLzmmK8gYGJ1dHRvbmDvvIzliJkgYHRhcmdldGAg5piv6Kem5Y+R6L+Z5qyh6L2s5Y+R5LqL5Lu255qEIGBidXR0b25g77yM5ZCm5YiZ5Li6IGB1bmRlZmluZWRgXG4gICAqXG4gICAqIOacgOS9juWfuuehgOW6k++8miBgMS4yLjRgICovXG4gIHRhcmdldDogYW55O1xuICAvKiog6aG16Z2i5Lit5YyF5ZCrYDx3ZWItdmlldz5g57uE5Lu25pe277yM6L+U5Zue5b2T5YmNYDx3ZWItdmlldz5g55qEdXJsXG4gICAqXG4gICAqIOacgOS9juWfuuehgOW6k++8miBgMS42LjRgXG4gICAqL1xuICB3ZWJWaWV3VXJsPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSUN1c3RvbVNoYXJlQ29udGVudCB7XG4gIC8qKiDovazlj5HmoIfpopjjgILpu5jorqTlgLzvvJrlvZPliY3lsI/nqIvluo/lkI3np7AgKi9cbiAgdGl0bGU/OiBzdHJpbmc7XG4gIC8qKiDovazlj5Hot6/lvoTvvIzlv4XpobvmmK/ku6UgLyDlvIDlpLTnmoTlrozmlbTot6/lvoTjgILpu5jorqTlgLzvvJrlvZPliY3pobXpnaIgcGF0aCAqL1xuICBwYXRoPzogc3RyaW5nO1xuICAvKiog6Ieq5a6a5LmJ5Zu+54mH6Lev5b6E77yM5Y+v5Lul5piv5pys5Zyw5paH5Lu26Lev5b6E44CB5Luj56CB5YyF5paH5Lu26Lev5b6E5oiW6ICF572R57uc5Zu+54mH6Lev5b6E44CC5pSv5oyBUE5H5Y+KSlBH44CC5pi+56S65Zu+54mH6ZW/5a695q+U5pivIDU6NO+8jOacgOS9juWfuuehgOW6k++8miBgMS41LjBg44CC6buY6K6k5YC877ya5L2/55So6buY6K6k5oiq5Zu+ICovXG4gIGltYWdlVXJsPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgQ29tcG9uZW50T3B0aW9uIHtcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbmludGVyZmFjZSBDb21wdXRlZCB7XG4gIFtrZXk6IHN0cmluZ106IGFueVxufVxuXG5pbnRlcmZhY2UgUGFnZU9wdGlvbiB7XG4gICAgW2tleTogc3RyaW5nXTogYW55LFxuICAgIC8qKlxuICAgICAqIOS+nei1liBzdG9yZSDkuIrnmoQgcGF0aFxuICAgICAqL1xuICAgIHVzZT86IEFycmF5PHN0cmluZyB8IG9iamVjdD5cbiAgICAvKipcbiAgICAgKiDorqHnrpflsZ7mgKdcbiAgICAgKi9cbiAgICBjb21wdXRlZD86IENvbXB1dGVkLFxuICAgIC8qKiDnlJ/lkb3lkajmnJ/lm57osIPigJTnm5HlkKzpobXpnaLliqDovb1cbiAgICAgKlxuICAgICAqIOmhtemdouWKoOi9veaXtuinpuWPkeOAguS4gOS4qumhtemdouWPquS8muiwg+eUqOS4gOasoe+8jOWPr+S7peWcqCBvbkxvYWQg55qE5Y+C5pWw5Lit6I635Y+W5omT5byA5b2T5YmN6aG16Z2i6Lev5b6E5Lit55qE5Y+C5pWw44CCXG4gICAgICovXG4gICAgb25Mb2FkPyhcbiAgICAgIC8qKiDmiZPlvIDlvZPliY3pobXpnaLot6/lvoTkuK3nmoTlj4LmlbAgKi9cbiAgICAgIHF1ZXJ5PzogeyBbcXVlcnlLZXk6IHN0cmluZ106IHN0cmluZyB9LFxuICAgICk6IHZvaWQ7XG4gICAgLyoqIOeUn+WRveWRqOacn+Wbnuiwg+KAlOebkeWQrOmhtemdouaYvuekulxuICAgICAqXG4gICAgICog6aG16Z2i5pi+56S6L+WIh+WFpeWJjeWPsOaXtuinpuWPkeOAglxuICAgICAqL1xuICAgIG9uU2hvdz8oKTogdm9pZDtcbiAgICAvKiog55Sf5ZG95ZGo5pyf5Zue6LCD4oCU55uR5ZCs6aG16Z2i5Yid5qyh5riy5p+T5a6M5oiQXG4gICAgICpcbiAgICAgKiDpobXpnaLliJ3mrKHmuLLmn5PlrozmiJDml7bop6blj5HjgILkuIDkuKrpobXpnaLlj6rkvJrosIPnlKjkuIDmrKHvvIzku6PooajpobXpnaLlt7Lnu4/lh4blpIflpqXlvZPvvIzlj6/ku6Xlkozop4blm77lsYLov5vooYzkuqTkupLjgIJcbiAgICAgKlxuXG4gICAgICog5rOo5oSP77ya5a+555WM6Z2i5YaF5a656L+b6KGM6K6+572u55qEIEFQSSDlpoJgd3guc2V0TmF2aWdhdGlvbkJhclRpdGxlYO+8jOivt+WcqGBvblJlYWR5YOS5i+WQjui/m+ihjOOAglxuICAgICovXG4gICAgb25SZWFkeT8oKTogdm9pZDtcbiAgICAvKiog55Sf5ZG95ZGo5pyf5Zue6LCD4oCU55uR5ZCs6aG16Z2i6ZqQ6JePXG4gICAgICpcbiAgICAgKiDpobXpnaLpmpDol48v5YiH5YWl5ZCO5Y+w5pe26Kem5Y+R44CCIOWmgiBgbmF2aWdhdGVUb2Ag5oiW5bqV6YOoIGB0YWJgIOWIh+aNouWIsOWFtuS7lumhtemdou+8jOWwj+eoi+W6j+WIh+WFpeWQjuWPsOetieOAglxuICAgICAqL1xuICAgIG9uSGlkZT8oKTogdm9pZDtcbiAgICAvKiog55Sf5ZG95ZGo5pyf5Zue6LCD4oCU55uR5ZCs6aG16Z2i5Y246L29XG4gICAgICpcbiAgICAgKiDpobXpnaLljbjovb3ml7bop6blj5HjgILlpoJgcmVkaXJlY3RUb2DmiJZgbmF2aWdhdGVCYWNrYOWIsOWFtuS7lumhtemdouaXtuOAglxuICAgICAqL1xuICAgIG9uVW5sb2FkPygpOiB2b2lkO1xuICAgIC8qKiDnm5HlkKznlKjmiLfkuIvmi4nliqjkvZxcbiAgICAgKlxuICAgICAqIOebkeWQrOeUqOaIt+S4i+aLieWIt+aWsOS6i+S7tuOAglxuICAgICAqIC0g6ZyA6KaB5ZyoYGFwcC5qc29uYOeahGB3aW5kb3dg6YCJ6aG55Lit5oiW6aG16Z2i6YWN572u5Lit5byA5ZCvYGVuYWJsZVB1bGxEb3duUmVmcmVzaGDjgIJcbiAgICAgKiAtIOWPr+S7pemAmui/h2B3eC5zdGFydFB1bGxEb3duUmVmcmVzaGDop6blj5HkuIvmi4nliLfmlrDvvIzosIPnlKjlkI7op6blj5HkuIvmi4nliLfmlrDliqjnlLvvvIzmlYjmnpzkuI7nlKjmiLfmiYvliqjkuIvmi4nliLfmlrDkuIDoh7TjgIJcbiAgICAgKiAtIOW9k+WkhOeQhuWujOaVsOaNruWIt+aWsOWQju+8jGB3eC5zdG9wUHVsbERvd25SZWZyZXNoYOWPr+S7peWBnOatouW9k+WJjemhtemdoueahOS4i+aLieWIt+aWsOOAglxuICAgICAqL1xuICAgIG9uUHVsbERvd25SZWZyZXNoPygpOiB2b2lkO1xuICAgIC8qKiDpobXpnaLkuIrmi4nop6blupXkuovku7bnmoTlpITnkIblh73mlbBcbiAgICAgKlxuICAgICAqIOebkeWQrOeUqOaIt+S4iuaLieinpuW6leS6i+S7tuOAglxuICAgICAqIC0g5Y+v5Lul5ZyoYGFwcC5qc29uYOeahGB3aW5kb3dg6YCJ6aG55Lit5oiW6aG16Z2i6YWN572u5Lit6K6+572u6Kem5Y+R6Led56a7YG9uUmVhY2hCb3R0b21EaXN0YW5jZWDjgIJcbiAgICAgKiAtIOWcqOinpuWPkei3neemu+WGhea7keWKqOacn+mXtO+8jOacrOS6i+S7tuWPquS8muiiq+inpuWPkeS4gOasoeOAglxuICAgICAqL1xuICAgIG9uUmVhY2hCb3R0b20/KCk6IHZvaWQ7XG4gICAgLyoqIOeUqOaIt+eCueWHu+WPs+S4iuinkui9rOWPkVxuICAgICAqXG4gICAgICog55uR5ZCs55So5oi354K55Ye76aG16Z2i5YaF6L2s5Y+R5oyJ6ZKu77yIYDxidXR0b24+YCDnu4Tku7YgYG9wZW4tdHlwZT1cInNoYXJlXCJg77yJ5oiW5Y+z5LiK6KeS6I+c5Y2V4oCc6L2s5Y+R4oCd5oyJ6ZKu55qE6KGM5Li677yM5bm26Ieq5a6a5LmJ6L2s5Y+R5YaF5a6544CCXG4gICAgICpcbiAgICAgKiAqKuazqOaEj++8muWPquacieWumuS5ieS6huatpOS6i+S7tuWkhOeQhuWHveaVsO+8jOWPs+S4iuinkuiPnOWNleaJjeS8muaYvuekuuKAnOi9rOWPkeKAneaMiemSrioqXG4gICAgICpcbiAgICAgKiDmraTkuovku7bpnIDopoEgcmV0dXJuIOS4gOS4qiBPYmplY3TvvIznlKjkuo7oh6rlrprkuYnovazlj5HlhoXlrrlcbiAgICAgKi9cbiAgICBvblNoYXJlQXBwTWVzc2FnZT8oXG4gICAgICAvKiog5YiG5Lqr5Y+R6LW35p2l5rqQ5Y+C5pWwICovXG4gICAgICBvcHRpb25zPzogSVNoYXJlQXBwTWVzc2FnZU9wdGlvbixcbiAgICApOiBJQ3VzdG9tU2hhcmVDb250ZW50O1xuICAgIC8qKiDpobXpnaLmu5rliqjop6blj5Hkuovku7bnmoTlpITnkIblh73mlbBcbiAgICAgKlxuICAgICAqIOebkeWQrOeUqOaIt+a7keWKqOmhtemdouS6i+S7tuOAglxuICAgICAqL1xuICAgIG9uUGFnZVNjcm9sbD8oXG4gICAgICAvKiog6aG16Z2i5rua5Yqo5Y+C5pWwICovXG4gICAgICBvcHRpb25zPzogSVBhZ2VTY3JvbGxPcHRpb24sXG4gICAgKTogdm9pZDtcblxuICAgIC8qKiDlvZPliY3mmK8gdGFiIOmhteaXtu+8jOeCueWHuyB0YWIg5pe26Kem5Y+R77yM5pyA5L2O5Z+656GA5bqT77yaIGAxLjkuMGAgKi9cbiAgICBvblRhYkl0ZW1UYXA/KFxuICAgICAgLyoqIHRhYiDngrnlh7vlj4LmlbAgKi9cbiAgICAgIG9wdGlvbnM/OiBJVGFiSXRlbVRhcE9wdGlvbixcbiAgICApOiB2b2lkO1xuXG4gICAgLyoqIOeql+WPo+WwuuWvuOaUueWPmOaXtuinpuWPke+8jOacgOS9juWfuuehgOW6k++8mmAyLjQuMGAgKi9cbiAgICBvblJlc2l6ZT8oXG4gICAgICAvKiog56qX5Y+j5bC65a+45Y+C5pWwICovXG4gICAgICBvcHRpb25zPzogSVJlc2l6ZU9wdGlvbixcbiAgICApOiB2b2lkO1xufVxuXG5pbnRlcmZhY2UgSVJlc2l6ZU9wdGlvbiB7XG4gIHNpemU6IHtcbiAgICAvKiog5Y+Y5YyW5ZCO55qE56qX5Y+j5a695bqm77yM5Y2V5L2NIHB4ICovXG4gICAgd2luZG93V2lkdGg6IG51bWJlcjtcbiAgICAvKiog5Y+Y5YyW5ZCO55qE56qX5Y+j6auY5bqm77yM5Y2V5L2NIHB4ICovXG4gICAgd2luZG93SGVpZ2h0OiBudW1iZXI7XG4gIH07XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZShzdG9yZTogYW55IHwgQ29tcG9uZW50T3B0aW9uLCBvcHRpb24/OiBQYWdlT3B0aW9uKSB7XG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAyKSB7XG4gICAgaWYgKCFzdG9yZS5pbnN0YW5jZXMpIHtcbiAgICAgIHN0b3JlLmluc3RhbmNlcyA9IHt9XG4gICAgfVxuXG4gICAgaWYoIXN0b3JlLm9uQ2hhbmdlKXtcbiAgICAgIHN0b3JlLm9uQ2hhbmdlID0gZnVuY3Rpb24oZm46IFN0b3JlQ2hhbmdlQ2FsbGJhY2spe1xuICAgICAgICBjaGFuZ2VzLnB1c2goZm4pXG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYoIXN0b3JlLm9mZkNoYW5nZSl7XG4gICAgICBzdG9yZS5vZmZDaGFuZ2UgPSBmdW5jdGlvbihmbjogU3RvcmVDaGFuZ2VDYWxsYmFjayl7XG4gICAgICAgIGZvcihsZXQgaSA9IDAsbGVuID1jaGFuZ2VzLmxlbmd0aDtpPGxlbjtpKyspe1xuICAgICAgICAgIGlmKGNoYW5nZXNbaV0gPT09IGZuKXtcbiAgICAgICAgICAgIGNoYW5nZXMuc3BsaWNlKGksIDEpXG4gICAgICAgICAgICBicmVha1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IGhhc0RhdGEgPSB0eXBlb2Ygb3B0aW9uLmRhdGEgIT09ICd1bmRlZmluZWQnXG4gICAgaWYgKG9wdGlvbi5kYXRhKSB7XG4gICAgICBvcHRpb24uZGF0YS4kID0gc3RvcmUuZGF0YVxuICAgIH0gZWxzZSB7XG4gICAgICBvcHRpb24uZGF0YSA9IHN0b3JlLmRhdGFcbiAgICB9XG4gICAgb2JzZXJ2ZVN0b3JlKHN0b3JlKVxuICAgIGNvbnN0IG9uTG9hZCA9IG9wdGlvbi5vbkxvYWRcblxuICAgIG9wdGlvbi5vbkxvYWQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgdGhpcy5zdG9yZSA9IHN0b3JlXG5cbiAgICAgIG9wdGlvbi51c2UgJiYgKHRoaXMuX191cGRhdGVQYXRoID0gZ2V0UGF0aChvcHRpb24udXNlKSlcbiAgICAgIHRoaXMuX191c2UgPSBvcHRpb24udXNlXG4gICAgICB0aGlzLl9faGFzRGF0YSA9IGhhc0RhdGFcbiAgICAgIHN0b3JlLmluc3RhbmNlc1t0aGlzLnJvdXRlXSA9IFtdXG4gICAgICBzdG9yZS5pbnN0YW5jZXNbdGhpcy5yb3V0ZV0ucHVzaCh0aGlzKVxuICAgICAgdGhpcy5jb21wdXRlZCA9IG9wdGlvbi5jb21wdXRlZFxuICAgICAgdGhpcy5zZXREYXRhKG9wdGlvbi5kYXRhKVxuICAgICAgY29uc3QgdXNpbmcgPSBnZXRVc2luZyhzdG9yZS5kYXRhLCBvcHRpb24udXNlKVxuXG4gICAgICBvcHRpb24uY29tcHV0ZWQgJiYgY29tcHV0ZShvcHRpb24uY29tcHV0ZWQsIHN0b3JlLCB1c2luZylcbiAgICAgIHRoaXMuc2V0RGF0YSh1c2luZylcblxuICAgICAgb25Mb2FkICYmIG9uTG9hZC5jYWxsKHRoaXMsIGUpXG4gICAgfVxuICAgIFBhZ2Uob3B0aW9uKVxuICB9IGVsc2Uge1xuICAgIGNvbnN0IHJlYWR5ID0gKHN0b3JlLmxpZmV0aW1lcyAmJiBzdG9yZS5saWZldGltZXMucmVhZHkpIHx8IHN0b3JlLnJlYWR5XG4gICAgc3RvcmUubGlmZXRpbWVzID0gc3RvcmUubGlmZXRpbWVzIHx8IHt9XG4gICAgc3RvcmUucmVhZHkgPSBzdG9yZS5saWZldGltZXMucmVhZHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zdCBwYWdlID0gZ2V0Q3VycmVudFBhZ2VzKClbZ2V0Q3VycmVudFBhZ2VzKCkubGVuZ3RoIC0gMV1cbiAgICAgIHN0b3JlLnVzZSAmJiAodGhpcy5fX3VwZGF0ZVBhdGggPSBnZXRQYXRoKHN0b3JlLnVzZSkpXG4gICAgICB0aGlzLnN0b3JlID0gcGFnZS5zdG9yZVxuICAgICAgdGhpcy5fX3VzZSA9IHN0b3JlLnVzZVxuICAgICAgdGhpcy5jb21wdXRlZCA9IHN0b3JlLmNvbXB1dGVkXG4gICAgICBzdG9yZS5kYXRhID0gdGhpcy5zdG9yZS5kYXRhXG4gICAgICB0aGlzLnNldERhdGEoc3RvcmUuZGF0YSlcbiAgICAgIGNvbnN0IHVzaW5nID0gZ2V0VXNpbmcodGhpcy5zdG9yZS5kYXRhLCBzdG9yZS51c2UpXG5cbiAgICAgIHN0b3JlLmNvbXB1dGVkICYmIGNvbXB1dGUoc3RvcmUuY29tcHV0ZWQsIHRoaXMuc3RvcmUsIHVzaW5nKVxuICAgICAgdGhpcy5zZXREYXRhKHVzaW5nKVxuXG4gICAgICB0aGlzLnN0b3JlLmluc3RhbmNlc1twYWdlLnJvdXRlXS5wdXNoKHRoaXMpXG4gICAgICByZWFkeSAmJiByZWFkeS5jYWxsKHRoaXMpXG4gICAgfVxuICAgIENvbXBvbmVudChzdG9yZSlcbiAgfVxufVxuXG5mdW5jdGlvbiBjb21wdXRlKGNvbXB1dGVkLCBzdG9yZSwgdXNpbmcpe1xuICBmb3IobGV0IGtleSBpbiBjb21wdXRlZCl7XG4gICAgdXNpbmdba2V5XSA9IGNvbXB1dGVkW2tleV0uY2FsbChzdG9yZS5kYXRhKVxuICB9XG59XG5cbmZ1bmN0aW9uIG9ic2VydmVTdG9yZShzdG9yZSkge1xuICBvYmFhKHN0b3JlLmRhdGEsIChwcm9wLCB2YWx1ZSwgb2xkLCBwYXRoKSA9PiB7XG4gICAgbGV0IHBhdGNoID0ge31cbiAgICBpZiAocHJvcC5pbmRleE9mKCdBcnJheS1wdXNoJykgPT09IDApIHtcbiAgICAgIGxldCBkbCA9IHZhbHVlLmxlbmd0aCAtIG9sZC5sZW5ndGhcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGw7IGkrKykge1xuICAgICAgICBwYXRjaFsgZml4UGF0aChwYXRoICsgJy0nICsgKG9sZC5sZW5ndGggKyBpKSldID0gdmFsdWVbKG9sZC5sZW5ndGggKyBpKV1cbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKHByb3AuaW5kZXhPZignQXJyYXktJykgPT09IDApIHtcbiAgICAgIHBhdGNoWyBmaXhQYXRoKHBhdGgpXSA9IHZhbHVlXG4gICAgfSBlbHNlIHtcbiAgICAgIHBhdGNoWyBmaXhQYXRoKHBhdGggKyAnLScgKyBwcm9wKV0gPSB2YWx1ZVxuICAgIH1cblxuICAgIF91cGRhdGUocGF0Y2gsIHN0b3JlKVxuXG5cbiAgfSlcbn1cblxuZnVuY3Rpb24gX3VwZGF0ZShrdiwgc3RvcmUpIHtcbiAgZm9yIChsZXQga2V5IGluIHN0b3JlLmluc3RhbmNlcykge1xuICAgIHN0b3JlLmluc3RhbmNlc1trZXldLmZvckVhY2goaW5zID0+IHtcbiAgICAgIGlmKHN0b3JlLnVwZGF0ZUFsbCB8fCBpbnMuX191cGRhdGVQYXRoICYmIG5lZWRVcGRhdGUoa3YsaW5zLl9fdXBkYXRlUGF0aCkpe1xuICAgICAgICBpZiAoaW5zLl9faGFzRGF0YSkge1xuICAgICAgICAgIGZvciAobGV0IHBrIGluIGt2KSB7XG4gICAgICAgICAgICBrdlsnJC4nICsgcGtdID0ga3ZbcGtdXG4gICAgICAgICAgICBkZWxldGUga3ZbcGtdXG4gICAgICAgICAgfVxuICAgICAgICAgIGlucy5zZXREYXRhLmNhbGwoaW5zLCBrdilcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpbnMuc2V0RGF0YS5jYWxsKGlucywga3YpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCB1c2luZyA9IGdldFVzaW5nKHN0b3JlLmRhdGEsIGlucy5fX3VzZSlcblxuICAgICAgICBjb21wdXRlKGlucy5jb21wdXRlZCwgc3RvcmUsIHVzaW5nKVxuICAgICAgICBpbnMuc2V0RGF0YSh1c2luZylcblxuXG4gICAgICB9XG4gICAgfSlcbiAgfVxuICBjaGFuZ2VzLmZvckVhY2goY2hhbmdlID0+IHtcbiAgICBjaGFuZ2Uoa3YpXG4gIH0pXG4gIHN0b3JlLmRlYnVnICYmIHN0b3JlQ2hhbmdlTG9nZ2VyKHN0b3JlLCBrdilcbn1cblxuZnVuY3Rpb24gc3RvcmVDaGFuZ2VMb2dnZXIgKHN0b3JlLCBkaWZmUmVzdWx0KSB7XG4gIHRyeSB7XG4gICAgICBjb25zdCBwcmVTdGF0ZSA9IHd4LmdldFN0b3JhZ2VTeW5jKGBDdXJyZW50U3RhdGVgKSB8fCB7fVxuICAgICAgY29uc3QgdGl0bGUgPSBgU3RhdGUgQ2hhbmdlZGBcbiAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoYCVjICAkeyB0aXRsZSB9ICVjICR7IE9iamVjdC5rZXlzKGRpZmZSZXN1bHQpIH1gLCAnY29sb3I6I2UwYzE4NDsgZm9udC13ZWlnaHQ6IGJvbGQnLCAnY29sb3I6I2YwYTEzOTsgZm9udC13ZWlnaHQ6IGJvbGQnKVxuICAgICAgY29uc29sZS5sb2coYCVjICAgIFByZSBTdGF0ZWAsICdjb2xvcjojZmY2NWFmOyBmb250LXdlaWdodDogYm9sZCcsIHByZVN0YXRlKVxuICAgICAgY29uc29sZS5sb2coYCVjIENoYW5nZSBTdGF0ZWAsICdjb2xvcjojM2Q5MWNmOyBmb250LXdlaWdodDogYm9sZCcsIGRpZmZSZXN1bHQpXG4gICAgICBjb25zb2xlLmxvZyhgJWMgICBOZXh0IFN0YXRlYCwgJ2NvbG9yOiMyYzlmNjc7IGZvbnQtd2VpZ2h0OiBib2xkJywgc3RvcmUuZGF0YSlcbiAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKVxuICAgICAgd3guc2V0U3RvcmFnZVN5bmMoYEN1cnJlbnRTdGF0ZWAsIHN0b3JlLmRhdGEpXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpXG4gIH1cblxufVxuXG5jcmVhdGUub2JhYSA9IG9iYWFcblxuXG5leHBvcnQgZGVmYXVsdCBjcmVhdGVcbiJdfQ==