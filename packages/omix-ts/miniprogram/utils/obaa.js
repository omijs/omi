"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var obaa = function (target, arr, callback) {
    var _observe = function (target, arr, callback) {
        var $observer = this;
        var eventPropArr = [];
        if (obaa.isArray(target)) {
            if (target.length === 0) {
                Object.defineProperty(target, '$observeProps', {
                    configurable: true,
                    enumerable: false,
                    writable: true,
                    value: {}
                });
                target.$observeProps.$observerPath = '#';
            }
            $observer.mock(target);
        }
        for (var prop in target) {
            if (target.hasOwnProperty(prop)) {
                if (callback) {
                    if (obaa.isArray(arr) && obaa.isInArray(arr, prop)) {
                        eventPropArr.push(prop);
                        $observer.watch(target, prop);
                    }
                    else if (obaa.isString(arr) && prop == arr) {
                        eventPropArr.push(prop);
                        $observer.watch(target, prop);
                    }
                }
                else {
                    eventPropArr.push(prop);
                    $observer.watch(target, prop);
                }
            }
        }
        $observer.target = target;
        if (!$observer.propertyChangedHandler)
            $observer.propertyChangedHandler = [];
        var propChanged = callback ? callback : arr;
        $observer.propertyChangedHandler.push({
            all: !callback,
            propChanged: propChanged,
            eventPropArr: eventPropArr
        });
    };
    _observe.prototype = {
        onPropertyChanged: function (prop, value, oldValue, target, path) {
            if (value !== oldValue && (!(nan(value) && nan(oldValue))) && this.propertyChangedHandler) {
                var rootName = obaa._getRootName(prop, path);
                for (var i = 0, len = this.propertyChangedHandler.length; i < len; i++) {
                    var handler = this.propertyChangedHandler[i];
                    if (handler.all ||
                        obaa.isInArray(handler.eventPropArr, rootName) ||
                        rootName.indexOf('Array-') === 0) {
                        handler.propChanged.call(this.target, prop, value, oldValue, path);
                    }
                }
            }
            if (prop.indexOf('Array-') !== 0 && typeof value === 'object') {
                this.watch(target, prop, target.$observeProps.$observerPath);
            }
        },
        mock: function (target) {
            var self = this;
            obaa.methods.forEach(function (item) {
                target[item] = function () {
                    var old = Array.prototype.slice.call(this, 0);
                    var result = Array.prototype[item].apply(this, Array.prototype.slice.call(arguments));
                    if (new RegExp('\\b' + item + '\\b').test(obaa.triggerStr)) {
                        for (var cprop in this) {
                            if (this.hasOwnProperty(cprop) &&
                                !obaa.isFunction(this[cprop])) {
                                self.watch(this, cprop, this.$observeProps.$observerPath);
                            }
                        }
                        self.onPropertyChanged('Array-' + item, this, old, this, this.$observeProps.$observerPath);
                    }
                    return result;
                };
                target['pure' + item.substring(0, 1).toUpperCase() + item.substring(1)] = function () {
                    return Array.prototype[item].apply(this, Array.prototype.slice.call(arguments));
                };
            });
        },
        watch: function (target, prop, path) {
            if (prop === '$observeProps' || prop === '$observer')
                return;
            if (obaa.isFunction(target[prop]))
                return;
            if (!target.$observeProps) {
                Object.defineProperty(target, '$observeProps', {
                    configurable: true,
                    enumerable: false,
                    writable: true,
                    value: {}
                });
            }
            if (path !== undefined) {
                target.$observeProps.$observerPath = path;
            }
            else {
                target.$observeProps.$observerPath = '#';
            }
            var self = this;
            var currentValue = (target.$observeProps[prop] = target[prop]);
            Object.defineProperty(target, prop, {
                get: function () {
                    return this.$observeProps[prop];
                },
                set: function (value) {
                    var old = this.$observeProps[prop];
                    this.$observeProps[prop] = value;
                    self.onPropertyChanged(prop, value, old, this, target.$observeProps.$observerPath);
                }
            });
            if (typeof currentValue == 'object') {
                if (obaa.isArray(currentValue)) {
                    this.mock(currentValue);
                    if (currentValue.length === 0) {
                        if (!currentValue.$observeProps) {
                            Object.defineProperty(currentValue, '$observeProps', {
                                configurable: true,
                                enumerable: false,
                                writable: true,
                                value: {}
                            });
                        }
                        if (path !== undefined) {
                            currentValue.$observeProps.$observerPath = path + '-' + prop;
                        }
                        else {
                            currentValue.$observeProps.$observerPath = '#' + '-' + prop;
                        }
                    }
                }
                for (var cprop in currentValue) {
                    if (currentValue.hasOwnProperty(cprop)) {
                        this.watch(currentValue, cprop, target.$observeProps.$observerPath + '-' + prop);
                    }
                }
            }
        }
    };
    return new _observe(target, arr, callback);
};
obaa.methods = [
    'concat',
    'copyWithin',
    'entries',
    'every',
    'fill',
    'filter',
    'find',
    'findIndex',
    'forEach',
    'includes',
    'indexOf',
    'join',
    'keys',
    'lastIndexOf',
    'map',
    'pop',
    'push',
    'reduce',
    'reduceRight',
    'reverse',
    'shift',
    'slice',
    'some',
    'sort',
    'splice',
    'toLocaleString',
    'toString',
    'unshift',
    'values',
    'size'
];
obaa.triggerStr = [
    'concat',
    'copyWithin',
    'fill',
    'pop',
    'push',
    'reverse',
    'shift',
    'sort',
    'splice',
    'unshift',
    'size'
].join(',');
obaa.isArray = function (obj) {
    return Object.prototype.toString.call(obj) === '[object Array]';
};
obaa.isString = function (obj) {
    return typeof obj === 'string';
};
obaa.isInArray = function (arr, item) {
    for (var i = arr.length; --i > -1;) {
        if (item === arr[i])
            return true;
    }
    return false;
};
obaa.isFunction = function (obj) {
    return Object.prototype.toString.call(obj) == '[object Function]';
};
obaa._getRootName = function (prop, path) {
    if (path === '#') {
        return prop;
    }
    return path.split('-')[1];
};
obaa.add = function (obj, prop) {
    var $observer = obj.$observer;
    $observer.watch(obj, prop);
};
obaa.set = function (obj, prop, value, exec) {
    if (!exec) {
        obj[prop] = value;
    }
    var $observer = obj.$observer;
    $observer.watch(obj, prop);
    if (exec) {
        obj[prop] = value;
    }
};
Array.prototype.size = function (length) {
    this.length = length;
};
function nan(value) {
    return typeof value === "number" && isNaN(value);
}
exports.default = obaa;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib2JhYS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIm9iYWEudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFNQSxJQUFJLElBQUksR0FBRyxVQUFTLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUTtJQUN2QyxJQUFJLFFBQVEsR0FBRyxVQUFTLE1BQU0sRUFBRSxHQUFHLEVBQUUsUUFBUTtRQUUzQyxJQUFJLFNBQVMsR0FBRyxJQUFJLENBQUE7UUFDcEIsSUFBSSxZQUFZLEdBQUcsRUFBRSxDQUFBO1FBQ3JCLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUN4QixJQUFJLE1BQU0sQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO2dCQUN2QixNQUFNLENBQUMsY0FBYyxDQUFDLE1BQU0sRUFBRSxlQUFlLEVBQUU7b0JBQzdDLFlBQVksRUFBRSxJQUFJO29CQUNsQixVQUFVLEVBQUUsS0FBSztvQkFDakIsUUFBUSxFQUFFLElBQUk7b0JBQ2QsS0FBSyxFQUFFLEVBQUU7aUJBQ1YsQ0FBQyxDQUFBO2dCQUNGLE1BQU0sQ0FBQyxhQUFhLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQTthQUN6QztZQUNELFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUE7U0FDdkI7UUFDRCxLQUFLLElBQUksSUFBSSxJQUFJLE1BQU0sRUFBRTtZQUN2QixJQUFJLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQy9CLElBQUksUUFBUSxFQUFFO29CQUNaLElBQUksSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsRUFBRSxJQUFJLENBQUMsRUFBRTt3QkFDbEQsWUFBWSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTt3QkFDdkIsU0FBUyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUE7cUJBQzlCO3lCQUFNLElBQUksSUFB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QUFDLENBQUE7QUFFRCxTQUFTLEdBQUcsQ0FBQyxLQUFLO0lBQ2QsT0FBTyxPQUFPLEtBQUssS0FBSyxRQUFRLElBQUksS0FBSyxDQUFDLEtBQUssQ0FBQyxDQUFBO0FBQ3BELENBQUM7QUFHRCxrQkFBZSxJQUFJLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBvYmFhIDEuMC4wXG4gKiBCeSBkbnR6aGFuZ1xuICogR2l0aHViOiBodHRwczovL2dpdGh1Yi5jb20vVGVuY2VudC9vbWlcbiAqIE1JVCBMaWNlbnNlZC5cbiAqL1xuXG52YXIgb2JhYSA9IGZ1bmN0aW9uKHRhcmdldCwgYXJyLCBjYWxsYmFjaykge1xuICB2YXIgX29ic2VydmUgPSBmdW5jdGlvbih0YXJnZXQsIGFyciwgY2FsbGJhY2spIHtcbiAgICAvL2lmICghdGFyZ2V0LiRvYnNlcnZlcikgdGFyZ2V0LiRvYnNlcnZlciA9IHRoaXNcbiAgICB2YXIgJG9ic2VydmVyID0gdGhpc1xuICAgIHZhciBldmVudFByb3BBcnIgPSBbXVxuICAgIGlmIChvYmFhLmlzQXJyYXkodGFyZ2V0KSkge1xuICAgICAgaWYgKHRhcmdldC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgJyRvYnNlcnZlUHJvcHMnLCB7XG4gICAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICAgIHdyaXRhYmxlOiB0cnVlLFxuICAgICAgICAgIHZhbHVlOiB7fVxuICAgICAgICB9KVxuICAgICAgICB0YXJnZXQuJG9ic2VydmVQcm9wcy4kb2JzZXJ2ZXJQYXRoID0gJyMnXG4gICAgICB9XG4gICAgICAkb2JzZXJ2ZXIubW9jayh0YXJnZXQpXG4gICAgfVxuICAgIGZvciAodmFyIHByb3AgaW4gdGFyZ2V0KSB7XG4gICAgICBpZiAodGFyZ2V0Lmhhc093blByb3BlcnR5KHByb3ApKSB7XG4gICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgIGlmIChvYmFhLmlzQXJyYXkoYXJyKSAmJiBvYmFhLmlzSW5BcnJheShhcnIsIHByb3ApKSB7XG4gICAgICAgICAgICBldmVudFByb3BBcnIucHVzaChwcm9wKVxuICAgICAgICAgICAgJG9ic2VydmVyLndhdGNoKHRhcmdldCwgcHJvcClcbiAgICAgICAgICB9IGVsc2UgaWYgKG9iYWEuaXNTdHJpbmcoYXJyKSAmJiBwcm9wID09IGFycikge1xuICAgICAgICAgICAgZXZlbnRQcm9wQXJyLnB1c2gocHJvcClcbiAgICAgICAgICAgICRvYnNlcnZlci53YXRjaCh0YXJnZXQsIHByb3ApXG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGV2ZW50UHJvcEFyci5wdXNoKHByb3ApXG4gICAgICAgICAgJG9ic2VydmVyLndhdGNoKHRhcmdldCwgcHJvcClcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICAkb2JzZXJ2ZXIudGFyZ2V0ID0gdGFyZ2V0XG4gICAgaWYgKCEkb2JzZXJ2ZXIucHJvcGVydHlDaGFuZ2VkSGFuZGxlcilcbiAgICAgICRvYnNlcnZlci5wcm9wZXJ0eUNoYW5nZWRIYW5kbGVyID0gW11cbiAgICB2YXIgcHJvcENoYW5nZWQgPSBjYWxsYmFjayA/IGNhbGxiYWNrIDogYXJyXG4gICAgJG9ic2VydmVyLnByb3BlcnR5Q2hhbmdlZEhhbmRsZXIucHVzaCh7XG4gICAgICBhbGw6ICFjYWxsYmFjayxcbiAgICAgIHByb3BDaGFuZ2VkOiBwcm9wQ2hhbmdlZCxcbiAgICAgIGV2ZW50UHJvcEFycjogZXZlbnRQcm9wQXJyXG4gICAgfSlcbiAgfVxuICBfb2JzZXJ2ZS5wcm90b3R5cGUgPSB7XG4gICAgb25Qcm9wZXJ0eUNoYW5nZWQ6IGZ1bmN0aW9uKHByb3AsIHZhbHVlLCBvbGRWYWx1ZSwgdGFyZ2V0LCBwYXRoKSB7XG4gICAgICBpZiAodmFsdWUgIT09IG9sZFZhbHVlICYmICghKG5hbih2YWx1ZSkgJiYgbmFuKG9sZFZhbHVlKSkpICYmIHRoaXMucHJvcGVydHlDaGFuZ2VkSGFuZGxlcikge1xuICAgICAgICB2YXIgcm9vdE5hbWUgPSBvYmFhLl9nZXRSb290TmFtZShwcm9wLCBwYXRoKVxuICAgICAgICBmb3IgKFxuICAgICAgICAgIHZhciBpID0gMCwgbGVuID0gdGhpcy5wcm9wZXJ0eUNoYW5nZWRIYW5kbGVyLmxlbmd0aDtcbiAgICAgICAgICBpIDwgbGVuO1xuICAgICAgICAgIGkrK1xuICAgICAgICApIHtcbiAgICAgICAgICB2YXIgaGFuZGxlciA9IHRoaXMucHJvcGVydHlDaGFuZ2VkSGFuZGxlcltpXVxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIGhhbmRsZXIuYWxsIHx8XG4gICAgICAgICAgICBvYmFhLmlzSW5BcnJheShoYW5kbGVyLmV2ZW50UHJvcEFyciwgcm9vdE5hbWUpIHx8XG4gICAgICAgICAgICByb290TmFtZS5pbmRleE9mKCdBcnJheS0nKSA9PT0gMFxuICAgICAgICAgICkge1xuICAgICAgICAgICAgaGFuZGxlci5wcm9wQ2hhbmdlZC5jYWxsKHRoaXMudGFyZ2V0LCBwcm9wLCB2YWx1ZSwgb2xkVmFsdWUsIHBhdGgpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAocHJvcC5pbmRleE9mKCdBcnJheS0nKSAhPT0gMCAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIHRoaXMud2F0Y2godGFyZ2V0LCBwcm9wLCB0YXJnZXQuJG9ic2VydmVQcm9wcy4kb2JzZXJ2ZXJQYXRoKVxuICAgICAgfVxuICAgIH0sXG4gICAgbW9jazogZnVuY3Rpb24odGFyZ2V0KSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXNcbiAgICAgIG9iYWEubWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgICAgdGFyZ2V0W2l0ZW1dID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIG9sZCA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRoaXMsIDApXG4gICAgICAgICAgdmFyIHJlc3VsdCA9IEFycmF5LnByb3RvdHlwZVtpdGVtXS5hcHBseShcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpXG4gICAgICAgICAgKVxuICAgICAgICAgIGlmIChuZXcgUmVnRXhwKCdcXFxcYicgKyBpdGVtICsgJ1xcXFxiJykudGVzdChvYmFhLnRyaWdnZXJTdHIpKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBjcHJvcCBpbiB0aGlzKSB7XG4gICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICB0aGlzLmhhc093blByb3BlcnR5KGNwcm9wKSAmJlxuICAgICAgICAgICAgICAgICFvYmFhLmlzRnVuY3Rpb24odGhpc1tjcHJvcF0pXG4gICAgICAgICAgICAgICkge1xuICAgICAgICAgICAgICAgIHNlbGYud2F0Y2godGhpcywgY3Byb3AsIHRoaXMuJG9ic2VydmVQcm9wcy4kb2JzZXJ2ZXJQYXRoKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvL3RvZG9cbiAgICAgICAgICAgIHNlbGYub25Qcm9wZXJ0eUNoYW5nZWQoXG4gICAgICAgICAgICAgICdBcnJheS0nICsgaXRlbSxcbiAgICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgICAgb2xkLFxuICAgICAgICAgICAgICB0aGlzLFxuICAgICAgICAgICAgICB0aGlzLiRvYnNlcnZlUHJvcHMuJG9ic2VydmVyUGF0aFxuICAgICAgICAgICAgKVxuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgICAgIH1cbiAgICAgICAgdGFyZ2V0W1xuICAgICAgICAgICdwdXJlJyArIGl0ZW0uc3Vic3RyaW5nKDAsIDEpLnRvVXBwZXJDYXNlKCkgKyBpdGVtLnN1YnN0cmluZygxKVxuICAgICAgICBdID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIEFycmF5LnByb3RvdHlwZVtpdGVtXS5hcHBseShcbiAgICAgICAgICAgIHRoaXMsXG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpXG4gICAgICAgICAgKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0sXG4gICAgd2F0Y2g6IGZ1bmN0aW9uKHRhcmdldCwgcHJvcCwgcGF0aCkge1xuICAgICAgaWYgKHByb3AgPT09ICckb2JzZXJ2ZVByb3BzJyB8fCBwcm9wID09PSAnJG9ic2VydmVyJykgcmV0dXJuXG4gICAgICBpZiAob2JhYS5pc0Z1bmN0aW9uKHRhcmdldFtwcm9wXSkpIHJldHVyblxuICAgICAgaWYgKCF0YXJnZXQuJG9ic2VydmVQcm9wcyl7XG4gICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsICckb2JzZXJ2ZVByb3BzJywge1xuICAgICAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZSxcbiAgICAgICAgICBlbnVtZXJhYmxlOiBmYWxzZSxcbiAgICAgICAgICB3cml0YWJsZTogdHJ1ZSxcbiAgICAgICAgICB2YWx1ZToge31cbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIGlmIChwYXRoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGFyZ2V0LiRvYnNlcnZlUHJvcHMuJG9ic2VydmVyUGF0aCA9IHBhdGhcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRhcmdldC4kb2JzZXJ2ZVByb3BzLiRvYnNlcnZlclBhdGggPSAnIydcbiAgICAgIH1cbiAgICAgIHZhciBzZWxmID0gdGhpc1xuICAgICAgdmFyIGN1cnJlbnRWYWx1ZSA9ICh0YXJnZXQuJG9ic2VydmVQcm9wc1twcm9wXSA9IHRhcmdldFtwcm9wXSlcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIHByb3AsIHtcbiAgICAgICAgZ2V0OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy4kb2JzZXJ2ZVByb3BzW3Byb3BdXG4gICAgICAgIH0sXG4gICAgICAgIHNldDogZnVuY3Rpb24odmFsdWUpIHtcbiAgICAgICAgICB2YXIgb2xkID0gdGhpcy4kb2JzZXJ2ZVByb3BzW3Byb3BdXG4gICAgICAgICAgdGhpcy4kb2JzZXJ2ZVByb3BzW3Byb3BdID0gdmFsdWVcbiAgICAgICAgICBzZWxmLm9uUHJvcGVydHlDaGFuZ2VkKFxuICAgICAgICAgICAgcHJvcCxcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgb2xkLFxuICAgICAgICAgICAgdGhpcyxcbiAgICAgICAgICAgIHRhcmdldC4kb2JzZXJ2ZVByb3BzLiRvYnNlcnZlclBhdGhcbiAgICAgICAgICApXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICBpZiAodHlwZW9mIGN1cnJlbnRWYWx1ZSA9PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAob2JhYS5pc0FycmF5KGN1cnJlbnRWYWx1ZSkpIHtcbiAgICAgICAgICB0aGlzLm1vY2soY3VycmVudFZhbHVlKVxuICAgICAgICAgIC8v5Li6MO+8jOWwseS4jeS8mui/m+S4i+mdoueahCBmb3Ig5b6q546v77yM5bCx5LiN5Lya5omn6KGM6YeM6Z2i55qEIHdhdGNo77yM5bCx5LiN5Lya5pyJICRvYnNlcnZlUHJvcHMg5bGe5oCnXG4gICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGlmICghY3VycmVudFZhbHVlLiRvYnNlcnZlUHJvcHMpe1xuICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoY3VycmVudFZhbHVlLCAnJG9ic2VydmVQcm9wcycsIHtcbiAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgZW51bWVyYWJsZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgd3JpdGFibGU6IHRydWUsXG4gICAgICAgICAgICAgICAgdmFsdWU6IHt9XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocGF0aCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZS4kb2JzZXJ2ZVByb3BzLiRvYnNlcnZlclBhdGggPSBwYXRoICsgJy0nICsgcHJvcFxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY3VycmVudFZhbHVlLiRvYnNlcnZlUHJvcHMuJG9ic2VydmVyUGF0aCA9ICcjJyArICctJyArIHByb3BcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgY3Byb3AgaW4gY3VycmVudFZhbHVlKSB7XG4gICAgICAgICAgaWYgKGN1cnJlbnRWYWx1ZS5oYXNPd25Qcm9wZXJ0eShjcHJvcCkpIHtcbiAgICAgICAgICAgIHRoaXMud2F0Y2goXG4gICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSxcbiAgICAgICAgICAgICAgY3Byb3AsXG4gICAgICAgICAgICAgIHRhcmdldC4kb2JzZXJ2ZVByb3BzLiRvYnNlcnZlclBhdGggKyAnLScgKyBwcm9wXG4gICAgICAgICAgICApXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIHJldHVybiBuZXcgX29ic2VydmUodGFyZ2V0LCBhcnIsIGNhbGxiYWNrKVxufVxuXG5vYmFhLm1ldGhvZHMgPSBbXG4gICdjb25jYXQnLFxuICAnY29weVdpdGhpbicsXG4gICdlbnRyaWVzJyxcbiAgJ2V2ZXJ5JyxcbiAgJ2ZpbGwnLFxuICAnZmlsdGVyJyxcbiAgJ2ZpbmQnLFxuICAnZmluZEluZGV4JyxcbiAgJ2ZvckVhY2gnLFxuICAnaW5jbHVkZXMnLFxuICAnaW5kZXhPZicsXG4gICdqb2luJyxcbiAgJ2tleXMnLFxuICAnbGFzdEluZGV4T2YnLFxuICAnbWFwJyxcbiAgJ3BvcCcsXG4gICdwdXNoJyxcbiAgJ3JlZHVjZScsXG4gICdyZWR1Y2VSaWdodCcsXG4gICdyZXZlcnNlJyxcbiAgJ3NoaWZ0JyxcbiAgJ3NsaWNlJyxcbiAgJ3NvbWUnLFxuICAnc29ydCcsXG4gICdzcGxpY2UnLFxuICAndG9Mb2NhbGVTdHJpbmcnLFxuICAndG9TdHJpbmcnLFxuICAndW5zaGlmdCcsXG4gICd2YWx1ZXMnLFxuICAnc2l6ZSdcbl1cbm9iYWEudHJpZ2dlclN0ciA9IFtcbiAgJ2NvbmNhdCcsXG4gICdjb3B5V2l0aGluJyxcbiAgJ2ZpbGwnLFxuICAncG9wJyxcbiAgJ3B1c2gnLFxuICAncmV2ZXJzZScsXG4gICdzaGlmdCcsXG4gICdzb3J0JyxcbiAgJ3NwbGljZScsXG4gICd1bnNoaWZ0JyxcbiAgJ3NpemUnXG5dLmpvaW4oJywnKVxuXG5vYmFhLmlzQXJyYXkgPSBmdW5jdGlvbihvYmopIHtcbiAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvYmopID09PSAnW29iamVjdCBBcnJheV0nXG59XG5cbm9iYWEuaXNTdHJpbmcgPSBmdW5jdGlvbihvYmopIHtcbiAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICdzdHJpbmcnXG59XG5cbm9iYWEuaXNJbkFycmF5ID0gZnVuY3Rpb24oYXJyLCBpdGVtKSB7XG4gIGZvciAodmFyIGkgPSBhcnIubGVuZ3RoOyAtLWkgPiAtMTsgKSB7XG4gICAgaWYgKGl0ZW0gPT09IGFycltpXSkgcmV0dXJuIHRydWVcbiAgfVxuICByZXR1cm4gZmFsc2Vcbn1cblxub2JhYS5pc0Z1bmN0aW9uID0gZnVuY3Rpb24ob2JqKSB7XG4gIHJldHVybiBPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwob2JqKSA9PSAnW29iamVjdCBGdW5jdGlvbl0nXG59XG5cbm9iYWEuX2dldFJvb3ROYW1lID0gZnVuY3Rpb24ocHJvcCwgcGF0aCkge1xuICBpZiAocGF0aCA9PT0gJyMnKSB7XG4gICAgcmV0dXJuIHByb3BcbiAgfVxuICByZXR1cm4gcGF0aC5zcGxpdCgnLScpWzFdXG59XG5cbm9iYWEuYWRkID0gZnVuY3Rpb24ob2JqLCBwcm9wKSB7XG4gIHZhciAkb2JzZXJ2ZXIgPSBvYmouJG9ic2VydmVyXG4gICRvYnNlcnZlci53YXRjaChvYmosIHByb3ApXG59XG5cbm9iYWEuc2V0ID0gZnVuY3Rpb24ob2JqLCBwcm9wLCB2YWx1ZSwgZXhlYykge1xuICBpZiAoIWV4ZWMpIHtcbiAgICBvYmpbcHJvcF0gPSB2YWx1ZVxuICB9XG4gIHZhciAkb2JzZXJ2ZXIgPSBvYmouJG9ic2VydmVyXG4gICRvYnNlcnZlci53YXRjaChvYmosIHByb3ApXG4gIGlmIChleGVjKSB7XG4gICAgb2JqW3Byb3BdID0gdmFsdWVcbiAgfVxufVxuXG5BcnJheS5wcm90b3R5cGUuc2l6ZSA9IGZ1bmN0aW9uKGxlbmd0aCkge1xuICB0aGlzLmxlbmd0aCA9IGxlbmd0aFxufVxuXG5mdW5jdGlvbiBuYW4odmFsdWUpIHtcbiAgICByZXR1cm4gdHlwZW9mIHZhbHVlID09PSBcIm51bWJlclwiICYmIGlzTmFOKHZhbHVlKVxufVxuXG5cbmV4cG9ydCBkZWZhdWx0IG9iYWFcblxuIl19